<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Teste â€“ GET /deploy</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background:#f0f2f5; margin:0; padding:2rem; }
    .card { background:#fff; max-width:900px; margin:0 auto; padding:1.5rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    label { display:block; margin-top:1rem; font-weight:600; }
    input { width:100%; padding:.6rem; border:1px solid #ddd; border-radius:8px; }
    button { margin-top:1rem; padding:.7rem 1rem; border:0; border-radius:8px; background:#0066cc; color:#fff; font-weight:700; cursor:pointer; }
    button:hover { opacity:.95; }
    pre { background:#0b1020; color:#d6e7ff; padding:1rem; border-radius:10px; overflow:auto; }
    a { color:#0066cc; font-weight:700; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .muted { color:#666; }
  </style>
  <script>
    (function () {
      const p = window.location.pathname;
      const prefix = p.includes("/static/") ? p.split("/static/")[0] : "";
      window.__APP_PREFIX__ = (prefix || "").replace(/\/$/, "");
      window.__BASE__ = window.location.origin + (window.__APP_PREFIX__ || "");
    })();
  </script>
</head>
<body>
  <div class="card">
    <h2>ðŸ§ª Teste â€“ GET /deploy</h2>
    <p class="muted">Base detectada: <strong id="base"></strong></p>

    <label>activityID</label>
    <input id="activityID" value="TESTE123" />

    <label>userID (opcional)</label>
    <input id="userID" placeholder="ex.: U1" />

    <button id="btn">Executar</button>

    <p><a id="openLink" href="#" target="_blank" rel="noreferrer">Abrir URL gerada</a></p>

    <h3>Resposta</h3>
    <pre id="out">{}</pre>

    <p><a href="index.html">Voltar</a></p>
  </div>

  <script>
    document.getElementById("base").textContent = window.__BASE__ + "/";
    const out = document.getElementById("out");
    const openLink = document.getElementById("openLink");

    function buildUrl() {
      const activityID = encodeURIComponent(document.getElementById("activityID").value.trim());
      const userIDRaw = document.getElementById("userID").value.trim();
      const qs = new URLSearchParams({ activityID });
      if (userIDRaw) qs.set("userID", userIDRaw);
      return window.__BASE__ + "/deploy?" + qs.toString();
    }

    document.getElementById("btn").addEventListener("click", async () => {
      const url = buildUrl();
      openLink.href = url;

      out.textContent = "A chamar: " + url + "\n\n";
      try {
        const res = await fetch(url);
        const text = await res.text();
        out.textContent += "HTTP " + res.status + "\n\n" + text;
      } catch (e) {
        out.textContent += "Erro: " + (e && e.message ? e.message : e);
      }
    });

    // inicializa link
    openLink.href = buildUrl();
  </script>
</body>
</html>
